<div id="pf12d" class="pf w0 h0" data-page-no="12d"><div class="pc pc12d w0 h0"><img class="bi x0 y8 w2 h5" alt="" src="bg12d.png"/><div class="t m0 x9 hf yf6 ff3 fs5 fc0 sc0 ls0 ws0">The following figure shows how the execution trace information is stored in memory as a</div><div class="t m0 x9 hf yf7 ff3 fs5 fc0 sc0 ls0 ws0">sequence of packets.</div><div class="c x4 y1ad3 w32 hc4"><div class="t m0 x8e hc5 y1ad4 ff2 fs50 fc0 sc0 ls0 ws0"> </div><div class="t m0 x8e hc5 y1ad5 ff2 fs50 fc0 sc0 ls0 ws0"> </div><div class="t m0 x8e hc5 y1ad6 ff2 fs50 fc0 sc0 ls0 ws0"> </div><div class="t m0 x8e hc5 y1ad7 ff2 fs50 fc0 sc0 ls0 ws0"> </div><div class="t m0 x8e hc5 y1ad8 ff2 fs50 fc0 sc0 ls0 ws0"> </div><div class="t m0 x8e hc5 y1ad9 ff2 fs50 fc0 sc0 ls0 ws0"> </div><div class="t m0 x35 hc5 y1ada ff2 fs50 fc0 sc0 ls0 ws0"> </div><div class="t m0 x1d hc5 y1adb ff2 fs50 fc0 sc0 ls0 ws0"> </div><div class="t m0 x16 hc5 y1adc ff2 fs50 fc0 sc0 ls0 ws0"> </div><div class="t m0 x0 hc6 y1add ff8 fs4 fc0 sc0 ls0">Incrementing</div><div class="t m0 x0 hc6 y1ade ff8 fs4 fc0 sc0 ls0 ws0">SRAM memor<span class="_ _5"></span>y</div><div class="t m0 x0 hc6 y1adf ff8 fs4 fc0 sc0 ls0">address</div><div class="t m0 x2 hc6 y1ae0 ff8 fs4 fc0 sc0 ls0 ws0">Nth destination address</div><div class="t m0 x2 hc6 y1ae1 ff8 fs4 fc0 sc0 ls0 ws0">Nth source address</div><div class="t m0 x48 hc6 y1ae2 ff8 fs4 fc0 sc0 ls0">S</div><div class="t m0 x48 hc6 y1ae1 ff8 fs4 fc0 sc0 ls0">A</div><div class="t m0 x12c hc7 y1ae3 ff8 fs4 fc0 sc0 ls0 ws2f8">31 <span class="v16">0</span></div><div class="t m0 x4c hc6 y1ae3 ff8 fs4 fc0 sc0 ls0">1</div><div class="t m0 x2 hc6 y1ae4 ff8 fs4 fc0 sc0 ls0 ws0">2nd destination address</div><div class="t m0 x2 hc6 y1ae5 ff8 fs4 fc0 sc0 ls0 ws0">2nd source address</div><div class="t m0 x48 hc6 y1ae6 ff8 fs4 fc0 sc0 ls0">S</div><div class="t m0 x48 hc6 y1ae5 ff8 fs4 fc0 sc0 ls0">A</div><div class="t m0 x12c hc8 y1ae7 ff8 fs4 fc0 sc0 ls0 ws2f8">31 <span class="v16">0</span></div><div class="t m0 x4c hc6 y1ae7 ff8 fs4 fc0 sc0 ls0">1</div><div class="t m0 x2 hc6 y1ae8 ff8 fs4 fc0 sc0 ls0 ws0">1st destination address</div><div class="t m0 x2 hc6 y1ae9 ff8 fs4 fc0 sc0 ls0 ws0">1st source address</div><div class="t m0 x48 hc6 y1aea ff8 fs4 fc0 sc0 ls0">S</div><div class="t m0 x48 hc6 y1ae9 ff8 fs4 fc0 sc0 ls0">A</div><div class="t m0 xd1 hc6 y1aeb ff8 fs4 fc0 sc0 ls0 ws0">Atom bit</div><div class="t m0 x21 hc6 y1aec ff8 fs4 fc0 sc0 ls0 ws0">Star<span class="_ _5"></span>t bit</div><div class="t m0 x4a hc6 y1aed ff8 fs4 fc0 sc0 ls0 ws0">Odd word address</div><div class="t m0 x4a hc6 y1aee ff8 fs4 fc0 sc0 ls0 ws0">Even w<span class="_ _16"></span>ord address</div><div class="t m0 x4a hc6 y1aef ff8 fs4 fc0 sc0 ls0 ws0">Odd word address</div><div class="t m0 x4a hc6 y1af0 ff8 fs4 fc0 sc0 ls0 ws0">Even w<span class="_ _16"></span>ord address</div></div><div class="t m0 x8c h9 y1af1 ff1 fs2 fc0 sc0 ls0 ws0">Figure 19-2. MTB execution trace storage format</div><div class="t m0 x9 hf y1af2 ff3 fs5 fc0 sc0 ls0 ws0">The first, lower addressed, word contains the source of the branch, the address it</div><div class="t m0 x9 hf y1af3 ff3 fs5 fc0 sc0 ls0 ws0">branched from. The value stored only records bits[31:1] of the source address, because</div><div class="t m0 x9 hf y1af4 ff3 fs5 fc0 sc0 ls0 ws0">Thumb instructions are at least halfword aligned. The least significant bit of the value is</div><div class="t m0 x9 hf y1af5 ff3 fs5 fc0 sc0 ls0 ws0">the A-bit. The A-bit indicates the atomic state of the processor at the time of the branch,</div><div class="t m0 x9 hf y1af6 ff3 fs5 fc0 sc0 ls0 ws0">and can differentiate whether the branch originated from an instruction in a program, an</div><div class="t m0 x9 hf y1af7 ff3 fs5 fc0 sc0 ls0 ws0">exception, or a PC update in Debug state. When it is zero the branch originated from an</div><div class="t m0 x9 hf y1af8 ff3 fs5 fc0 sc0 ls0 ws0">instruction, when it is one the branch originated from an exception or PC update in</div><div class="t m0 x9 hf y1af9 ff3 fs5 fc0 sc0 ls0 ws0">Debug state. This word is always stored at an even word location.</div><div class="t m0 x9 hf y1afa ff3 fs5 fc0 sc0 ls0 ws0">The second, higher addressed word contains the destination of the branch, the address it</div><div class="t m0 x9 hf y1afb ff3 fs5 fc0 sc0 ls0 ws0">branched to. The value stored only records bits[31:1] of the branch address. The least</div><div class="t m0 x9 hf y1afc ff3 fs5 fc0 sc0 ls0 ws0">significant bit of the value is the S-bit. The S-bit indicates where the trace started. An S-</div><div class="t m0 x9 hf y1afd ff3 fs5 fc0 sc0 ls0 ws0">bit value of 1 indicates where the first packet after the trace started and a value of 0 is</div><div class="t m0 x9 hf y1afe ff3 fs5 fc0 sc0 ls0 ws0">used for other packets. Because it is possible to start and stop tracing multiple times in a</div><div class="t m0 x9 hf y1aff ff3 fs5 fc0 sc0 ls0 ws0">trace session, the memory might contain several packets with the S-bit set to 1. This word</div><div class="t m0 x9 hf y1b00 ff3 fs5 fc0 sc0 ls0 ws0">is always stored in the next higher word in memory, an odd word address.</div><div class="t m0 x9 hf y1b01 ff3 fs5 fc0 sc0 ls0 ws0">When the A-bit is set to 1, the source address field contains the architecturally-preferred</div><div class="t m0 x9 hf y1b02 ff3 fs5 fc0 sc0 ls0 ws0">return address for the exception. For example, if an exception was caused by an SVC</div><div class="t m0 x9 hf y1b03 ff3 fs5 fc0 sc0 ls0 ws0">instruction, then the source address field contains the address of the following instruction.</div><div class="t m0 x9 hf y1b04 ff3 fs5 fc0 sc0 ls0 ws0">This is different from the case where the A-bit is set to 0. In this case, the source address</div><div class="t m0 x9 hf y1b05 ff3 fs5 fc0 sc0 ls0 ws0">contains the address of the branch instruction.</div><div class="t m0 x9 hf y1b06 ff3 fs5 fc0 sc0 ls0 ws0">For an exception return operation, two packets are generated:</div><div class="t m0 x33 hf y1b07 ff3 fs5 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>The first packet has the:</div><div class="t m0 x2 hf y1b08 ff3 fs5 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>Source address field set to the address of the instruction that causes the exception</div><div class="t m0 x3d hf y1b09 ff3 fs5 fc0 sc0 ls0 ws0">return, BX or POP.</div><div class="t m0 x80 h10 y141 ff1 fs4 fc0 sc0 ls0 ws0">Chapter 19 Micro Trace Buffer (MTB)</div><div class="t m0 x8 h6 y9 ff1 fs3 fc0 sc0 ls0 ws0">KL25 Sub-Family Reference Manual, Rev. 3, September 2012</div><div class="t m0 x9 h7 ya ff2 fs4 fc0 sc0 ls0 ws0">Freescale Semiconductor, Inc.<span class="_ _113"> </span>301</div></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>
