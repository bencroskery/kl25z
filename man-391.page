<div id="pf187" class="pf w0 h0" data-page-no="187"><div class="pc pc187 w0 h0"><img class="bi x0 y8 w2 h5" alt="" src="bg187.png"/><div class="t m0 x9 hf yf6 ff3 fs5 fc0 sc0 ls0 ws0">Before the ATM can be enabled, the ATM expected count needs to be derived and stored</div><div class="t m0 x9 hf yf7 ff3 fs5 fc0 sc0 ls0 ws0">into the ATCV register. The ATCV expected count is derived based on the required</div><div class="t m0 x9 hf yf8 ff3 fs5 fc0 sc0 ls0 ws0">target Internal Reference Clock (IRC) frequency, and the frequency of the external</div><div class="t m0 x9 hf yf9 ff3 fs5 fc0 sc0 ls0 ws0">reference clock using the following formula:</div><div class="c x51 y22f6 w3c he8"><div class="t m2c x0 he9 y22f7 ff2 fs70 fc0 sc0 ls0">ATCV</div></div><div class="t m0 x33 hf y22f8 ff3 fs5 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>Fr = Target Internal Reference Clock (IRC) Trimmed Frequency</div><div class="t m0 x33 hf y22f9 ff3 fs5 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>Fe = External Clock Frequency</div><div class="t m0 x9 hf y22fa ff3 fs5 fc0 sc0 ls0 ws0">If the auto trim is being performed on the 4 MHz IRC, the calculated expected count</div><div class="t m0 x9 hf y22fb ff3 fs5 fc0 sc0 ls0 ws0">value must be multiplied by 128 before storing it in the ATCV register. Therefore, the</div><div class="t m0 x9 hf y22fc ff3 fs5 fc0 sc0 ls0 ws0">ATCV Expected Count Value for trimming the 4 MHz IRC is calculated using the</div><div class="t m0 x9 hf y22fd ff3 fs5 fc0 sc0 ls0 ws0">following formula.</div><div class="c x51 y22fe w3d he8"><div class="t m0 x17 hea y22ff ff2 fs71 fc0 sc0 ls0">(128)</div></div><div class="t m0 x9 hd y2300 ff1 fs7 fc0 sc0 ls0 ws0">24.5<span class="_ _b"> </span>Initialization / Application information</div><div class="t m0 x9 hf y2301 ff3 fs5 fc0 sc0 ls0 ws0">This section describes how to initialize and configure the MCG module in an application.</div><div class="t m0 x9 hf y2302 ff3 fs5 fc0 sc0 ls0 ws0">The following sections include examples on how to initialize the MCG and properly</div><div class="t m0 x9 hf y2303 ff3 fs5 fc0 sc0 ls0 ws0">switch between the various available modes.</div><div class="t m0 x9 he y2304 ff1 fs1 fc0 sc0 ls0 ws0">24.5.1<span class="_ _b"> </span>MCG module initialization sequence</div><div class="t m0 x9 hf y2305 ff3 fs5 fc0 sc0 ls0 ws0">The MCG comes out of reset configured for FEI mode. The internal reference will</div><div class="t m0 x9 hf y2306 ff3 fs5 fc0 sc0 ls0 ws0">stabilize in t<span class="fs8 ws198 vc">irefsts</span> microseconds before the FLL can acquire lock. As soon as the internal</div><div class="t m0 x9 hf y2307 ff3 fs5 fc0 sc0 ls0 ws0">reference is stable, the FLL will acquire lock in t<span class="fs8 ws198 vc">fll_acquire</span> milliseconds.</div><div class="t m0 x9 h1b y2308 ff1 fsc fc0 sc0 ls0 ws0">24.5.1.1<span class="_ _b"> </span>Initializing the MCG</div><div class="t m0 x9 hf y2309 ff3 fs5 fc0 sc0 ls0 ws0">Because the MCG comes out of reset in FEI mode, the only MCG modes that can be</div><div class="t m0 x9 hf y230a ff3 fs5 fc0 sc0 ls0 ws0">directly switched to upon reset are FEE, FBE, and FBI modes (see <span class="fc1">Figure 24-16</span>).</div><div class="t m0 x9 hf y230b ff3 fs5 fc0 sc0 ls0 ws0">Reaching any of the other modes requires first configuring the MCG for one of these</div><div class="t m0 x9 hf y230c ff3 fs5 fc0 sc0 ls0 ws0">three intermediate modes. Care must be taken to check relevant status bits in the MCG</div><div class="t m0 x9 hf y230d ff3 fs5 fc0 sc0 ls0 ws0">status register reflecting all configuration changes within each mode.</div><div class="t m0 x9 hf y230e ff3 fs5 fc0 sc0 ls0 ws0">To change from FEI mode to FEE or FBE modes, follow this procedure:</div><div class="t m0 xf6 hf y230f ff3 fs5 fc0 sc0 ls0 ws0">1.<span class="_ _11"> </span>Enable the external clock source by setting the appropriate bits in C2 register.</div><div class="t m0 x102 h10 y141 ff1 fs4 fc0 sc0 ls0 ws0">Chapter 24 Multipurpose Clock Generator (MCG)</div><div class="t m0 x8 h6 y9 ff1 fs3 fc0 sc0 ls0 ws0">KL25 Sub-Family Reference Manual, Rev. 3, September 2012</div><div class="t m0 x9 h7 ya ff2 fs4 fc0 sc0 ls0 ws0">Freescale Semiconductor, Inc.<span class="_ _113"> </span>391</div><a class="l" href="#pf180" data-dest-detail='[384,"XYZ",null,577.2,null]'><div class="d m1" style="border-style:none;position:absolute;left:429.620000px;bottom:170.145000px;width:72.716000px;height:14.000000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>
