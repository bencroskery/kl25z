<div id="pf18f" class="pf w0 h0" data-page-no="18f"><div class="pc pc18f w0 h0"><img class="bi x0 y8 w2 h5" alt="" src="bg18f.png"/><div class="t m0 x9 h1b y2d7 ff1 fsc fc0 sc0 ls0 ws0">24.5.3.2<span class="_ _b"> </span>Example 2: Moving from PEE to BLPI mode: MCGOUTCLK</div><div class="t m0 xac h1b y1544 ff1 fsc fc0 sc0 ls0 ws0">frequency =32 kHz</div><div class="t m0 x9 hf y282 ff3 fs5 fc0 sc0 ls0 ws0">In this example, the MCG will move through the proper operational modes from PEE</div><div class="t m0 x9 hf y283 ff3 fs5 fc0 sc0 ls0 ws0">mode with a 4 MHz crystal configured for a 48 MHz MCGOUTCLK frequency (see</div><div class="t m0 x9 hf y2d8 ff3 fs5 fc0 sc0 ls0 ws0">previous example) to BLPI mode with a 32 kHz MCGOUTCLK frequency. First, the</div><div class="t m0 x9 hf y23ac ff3 fs5 fc0 sc0 ls0 ws0">code sequence will be described. Then there is a flowchart that illustrates the sequence.</div><div class="t m0 xf6 hf y23ad ff3 fs5 fc0 sc0 ls0 ws0">1.<span class="_ _11"> </span>First, PEE must transition to PBE mode:</div><div class="t m0 x8b hf y23ae ff3 fs5 fc0 sc0 ls0 ws0">a.<span class="_ _11"> </span>C1 = 0x90</div><div class="t m0 x29 hf y23af ff3 fs5 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>C1[CLKS] set to 2&apos;b10 to switch the system clock source to the external</div><div class="t m0 x3e hf y23b0 ff3 fs5 fc0 sc0 ls0 ws0">reference clock.</div><div class="t m0 x8b hf y23b1 ff3 fs5 fc0 sc0 ls0 ws0">b.<span class="_ _11"> </span>Loop until S[CLKST] are 2&apos;b10, indicating that the external reference clock is</div><div class="t m0 x3d hf y23b2 ff3 fs5 fc0 sc0 ls0 ws0">selected to feed MCGOUTCLK.</div><div class="t m0 xf6 hf y23b3 ff3 fs5 fc0 sc0 ls0 ws0">2.<span class="_ _11"> </span>Then, PBE must transition either directly to FBE mode or first through BLPE mode</div><div class="t m0 x117 hf y23b4 ff3 fs5 fc0 sc0 ls0 ws0">and then to FBE mode:</div><div class="t m0 x8b hf y23b5 ff3 fs5 fc0 sc0 ls0 ws0">a.<span class="_ _11"> </span>BLPE: If a transition through BLPE mode is desired, first set C2[LP] to 1.</div><div class="t m0 x8b hf y23b6 ff3 fs5 fc0 sc0 ls0 ws0">b.<span class="_ _11"> </span>BLPE/FBE: C6 = 0x00</div><div class="t m0 x29 hf y23b7 ff3 fs5 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>C6[PLLS] clear to 0 to select the FLL. At this time, with C1[FRDIV] value</div><div class="t m0 x3e hf y23b8 ff3 fs5 fc0 sc0 ls0 ws0">of 3&apos;b010, the FLL divider is set to 128, resulting in a reference frequency of</div><div class="t m0 x3e hf y23b9 ff3 fs5 fc0 sc0 ls0 ws0">4 MHz / 128 = 31.25 kHz. If C1[FRDIV] was not previously set to 3&apos;b010</div><div class="t m0 x3e hf y23ba ff3 fs5 fc0 sc0 ls0 ws0">(necessary to achieve required 31.25–39.06 kHz FLL reference frequency</div><div class="t m0 x3e hf y23bb ff3 fs5 fc0 sc0 ls0 ws0">with an 4 MHz external source frequency), it must be changed prior to</div><div class="t m0 x3e hf y23bc ff3 fs5 fc0 sc0 ls0 ws0">clearing C6[PLLS] bit. In BLPE mode,changing this bit only prepares the</div><div class="t m0 x3e hf y23bd ff3 fs5 fc0 sc0 ls0 ws0">MCG for FLL usage in FBE mode. With C6[PLLS] = 0, the C6[VDIV0]</div><div class="t m0 x3e hf y23be ff3 fs5 fc0 sc0 ls0 ws0">value does not matter.</div><div class="t m0 x8b hf y23bf ff3 fs5 fc0 sc0 ls0 ws0">c.<span class="_ _11"> </span>BLPE: If transitioning through BLPE mode, clear C2[LP] to 0 here to switch to</div><div class="t m0 x3d hf y23c0 ff3 fs5 fc0 sc0 ls0 ws0">FBE mode.</div><div class="t m0 x8b hf y23c1 ff3 fs5 fc0 sc0 ls0 ws0">d.<span class="_ _11"> </span>FBE: Loop until S[PLLST] is cleared, indicating that the current source for the</div><div class="t m0 x3d hf y23c2 ff3 fs5 fc0 sc0 ls0 ws0">PLLS clock is the FLL.</div><div class="t m0 xf6 hf y23c3 ff3 fs5 fc0 sc0 ls0 ws0">3.<span class="_ _11"> </span>Next, FBE mode transitions into FBI mode:</div><div class="t m0 x8b hf y23c4 ff3 fs5 fc0 sc0 ls0 ws0">a.<span class="_ _11"> </span>C1 = 0x54</div><div class="t m0 x29 hf y23c5 ff3 fs5 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>C1[CLKS] set to 2&apos;b01 to switch the system clock to the internal reference</div><div class="t m0 x3e hf y23c6 ff3 fs5 fc0 sc0 ls0">clock.</div><div class="t m0 x102 h10 y141 ff1 fs4 fc0 sc0 ls0 ws0">Chapter 24 Multipurpose Clock Generator (MCG)</div><div class="t m0 x8 h6 y9 ff1 fs3 fc0 sc0 ls0 ws0">KL25 Sub-Family Reference Manual, Rev. 3, September 2012</div><div class="t m0 x9 h7 ya ff2 fs4 fc0 sc0 ls0 ws0">Freescale Semiconductor, Inc.<span class="_ _113"> </span>399</div></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>
