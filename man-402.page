<div id="pf192" class="pf w0 h0" data-page-no="192"><div class="pc pc192 w0 h0"><img class="bi x0 y8 w2 h5" alt="" src="bg192.png"/><div class="t m0 x9 h1b y502 ff1 fsc fc0 sc0 ls0 ws0">24.5.3.3<span class="_ _b"> </span>Example 3: Moving from BLPI to FEE mode</div><div class="t m0 x9 hf y503 ff3 fs5 fc0 sc0 ls0 ws0">In this example, the MCG will move through the proper operational modes from BLPI</div><div class="t m0 x9 hf y504 ff3 fs5 fc0 sc0 ls0 ws0">mode at a 32 kHz MCGOUTCLK frequency running off the internal reference clock (see</div><div class="t m0 x9 hf y505 ff3 fs5 fc0 sc0 ls0 ws0">previous example) to FEE mode using a 4 MHz crystal configured for a 20 MHz</div><div class="t m0 x9 hf y629 ff3 fs5 fc0 sc0 ls0 ws0">MCGOUTCLK frequency. First, the code sequence will be described. Then there is a</div><div class="t m0 x9 hf y62a ff3 fs5 fc0 sc0 ls0 ws0">flowchart that illustrates the sequence.</div><div class="t m0 xf6 hf y674 ff3 fs5 fc0 sc0 ls0 ws0">1.<span class="_ _11"> </span>First, BLPI must transition to FBI mode.</div><div class="t m0 x8b hf y23f0 ff3 fs5 fc0 sc0 ls0 ws0">a.<span class="_ _11"> </span>C2 = 0x00</div><div class="t m0 x29 hf y23f1 ff3 fs5 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>C2[LP] is 0</div><div class="t m0 xf6 hf y23f2 ff3 fs5 fc0 sc0 ls0 ws0">2.<span class="_ _11"> </span>Next, FBI will transition to FEE mode.</div><div class="t m0 x8b hf y23f3 ff3 fs5 fc0 sc0 ls0 ws0">a.<span class="_ _11"> </span>C2 = 0x1C</div><div class="t m0 x29 hf y23f4 ff3 fs5 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>C2[RANGE0] set to 2&apos;b01 because the frequency of 4 MHz is within the</div><div class="t m0 x3e hf y23f5 ff3 fs5 fc0 sc0 ls0 ws0">high frequency range.</div><div class="t m0 x29 hf y23f6 ff3 fs5 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>C2[HGO0] set to 1 to configure the crystal oscillator for high gain operation.</div><div class="t m0 x29 hf y23f7 ff3 fs5 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>C2[EREFS0] set to 1, because a crystal is being used.</div><div class="t m0 x8b hf y23f8 ff3 fs5 fc0 sc0 ls0 ws0">b.<span class="_ _11"> </span>C1 = 0x10</div><div class="t m0 x29 hf y23f9 ff3 fs5 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>C1[CLKS] set to 2&apos;b00 to select the output of the FLL as system clock</div><div class="t m0 x3e hf y23fa ff3 fs5 fc0 sc0 ls0">source.</div><div class="t m0 x29 hf y23fb ff3 fs5 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>C1[FRDIV] remain at 3&apos;b010, or divide-by-128 for a reference of 4 MHz /</div><div class="t m0 x3e hf y23fc ff3 fs5 fc0 sc0 ls0 ws0">128 = 31.25 kHz.</div><div class="t m0 x29 hf y23fd ff3 fs5 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>C1[IREFS] cleared to 0, selecting the external reference clock.</div><div class="t m0 x8b hf y23fe ff3 fs5 fc0 sc0 ls0 ws0">c.<span class="_ _11"> </span>Loop until S[OSCINIT0] is 1, indicating the crystal selected by the C2[EREFS0]</div><div class="t m0 x3d hf y23ff ff3 fs5 fc0 sc0 ls0 ws0">bit has been initialized.</div><div class="t m0 x8b hf y2400 ff3 fs5 fc0 sc0 ls0 ws0">d.<span class="_ _11"> </span>Loop until S[IREFST] is 0, indicating the external reference clock is the current</div><div class="t m0 x3d hf y2401 ff3 fs5 fc0 sc0 ls0 ws0">source for the reference clock.</div><div class="t m0 x8b hf y2402 ff3 fs5 fc0 sc0 ls0 ws0">e.<span class="_ _11"> </span>Loop until S[CLKST] are 2&apos;b00, indicating that the output of the FLL is selected</div><div class="t m0 x3d hf y2403 ff3 fs5 fc0 sc0 ls0 ws0">to feed MCGOUTCLK.</div><div class="t m0 x39 hf y22d1 ff3 fs5 fc0 sc0 ls0 ws0">f.<span class="_ _11"> </span>Now, with a 31.25 kHz reference frequency, a fixed DCO multiplier of 640,</div><div class="t m0 x3d hf y22d2 ff3 fs5 fc0 sc0 ls0 ws0">MCGOUTCLK = 31.25 kHz * 640 / 1 = 20 MHz.</div><div class="t m0 x8b hf y2404 ff3 fs5 fc0 sc0 ls0 ws0">g.<span class="_ _11"> </span>At this point, by default, the C4[DRST_DRS] bits are set to 2&apos;b00 and</div><div class="t m0 x3d hf y2405 ff3 fs5 fc0 sc0 ls0 ws0">C4[DMX32] is cleared to 0. If the MCGOUTCLK frequency of 40 MHz is</div><div class="t m0 x3d hf y2406 ff3 fs5 fc0 sc0 ls0 ws0">desired instead, set the C4[DRST_DRS] bits to 0x01 to switch the FLL</div><div class="t m0 x9 h10 ydd ff1 fs4 fc0 sc0 ls0 ws0">Initialization / Application information</div><div class="t m0 x8 h6 y9 ff1 fs3 fc0 sc0 ls0 ws0">KL25 Sub-Family Reference Manual, Rev. 3, September 2012</div><div class="t m0 x9 h7 ya ff2 fs4 fc0 sc0 ls0 ws0">402<span class="_ _113"> </span>Freescale Semiconductor, Inc.</div></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>
