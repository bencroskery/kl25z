<div id="pf26b" class="pf w0 h0" data-page-no="26b"><div class="pc pc26b w0 h0"><img class="bi x0 y8 w3 h5" alt="" src="bg26b.png"/><div class="t m0 x4c h9 y1a5 ff1 fs2 fc0 sc0 ls0 ws0">Table 35-4.<span class="_ _1a"> </span>Buffer descriptor fields (continued)</div><div class="t m0 x8e h10 y1a6 ff1 fs4 fc0 sc0 ls0 ws436">Field Description</div><div class="t m0 x3a h7 y1a7 ff2 fs4 fc0 sc0 ls0 ws0">TOK_PID[n]<span class="_ _165"> </span>Bits [5:2] can also represent the current token PID. The current token PID is written back in to the</div><div class="t m0 xbc h7 y1a8 ff2 fs4 fc0 sc0 ls0 ws0">BD by the USB-FS when a transfer completes. The values written back are the token PID values</div><div class="t m0 xbc h7 y1a9 ff2 fs4 fc0 sc0 ls0 ws0">from the USB specification:</div><div class="t m0 x3 h7 y919 ff2 fs4 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>0x1h for an OUT token.</div><div class="t m0 x3 h7 y366b ff2 fs4 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>0x9h for an IN token.</div><div class="t m0 x3 h7 yb3b ff2 fs4 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>0xDh for a SETUP token.</div><div class="t m0 xbc h7 y366c ff2 fs4 fc0 sc0 ls0 ws0">In host mode, this field is used to report the last returned PID or a transfer status indication. The</div><div class="t m0 xbc h7 y366d ff2 fs4 fc0 sc0 ls0 ws0">possible values returned are:</div><div class="t m0 x3 h7 y286 ff2 fs4 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>0x3h DATA0</div><div class="t m0 x3 h7 y366e ff2 fs4 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>0xBh DATA1</div><div class="t m0 x3 h7 y1291 ff2 fs4 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>0x2h ACK</div><div class="t m0 x3 h7 y366f ff2 fs4 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>0xEh STALL</div><div class="t m0 x3 h7 y3670 ff2 fs4 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>0xAh NAK</div><div class="t m0 x3 h7 y3671 ff2 fs4 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>0x0h Bus Timeout</div><div class="t m0 x3 h7 y276c ff2 fs4 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>0xFh Data Error</div><div class="t m0 x81 h7 y276d ff2 fs4 fc0 sc0 ls0">1–0</div><div class="t m0 x94 h7 y3672 ff2 fs4 fc0 sc0 ls0">Reserved</div><div class="t m0 xbc h7 y276d ff2 fs4 fc0 sc0 ls0 ws0">Reserved, should read as zeroes.</div><div class="t m0 x3a h7 y3673 ff2 fs4 fc0 sc0 ls0 ws437">ADDR[31:0] Address</div><div class="t m0 xbc h7 y3674 ff2 fs4 fc0 sc0 ls0 ws0">Represents the 32-bit buffer address in system memory. These bits are unchanged by the USB-</div><div class="t m0 xbc h7 y3675 ff2 fs4 fc0 sc0 ls0">FS.</div><div class="t m0 x9 he y3676 ff1 fs1 fc0 sc0 ls0 ws0">35.3.5<span class="_ _b"> </span>USB transaction</div><div class="t m0 x9 hf y3677 ff3 fs5 fc0 sc0 ls0 ws0">When the USB-FS transmits or receives data, it computes the BDT address using the</div><div class="t m0 x9 hf y3678 ff3 fs5 fc0 sc0 ls0 ws0">address generation shown in &quot;Addressing Buffer Descriptor Entries&quot; table.</div><div class="t m0 x9 hf y970 ff3 fs5 fc0 sc0 ls0 ws0">If OWN =1, the following process occurs:</div><div class="t m0 xf6 hf y3679 ff3 fs5 fc0 sc0 ls0 ws0">1.<span class="_ _11"> </span>The USB-FS reads the BDT.</div><div class="t m0 xf6 hf y367a ff3 fs5 fc0 sc0 ls0 ws0">2.<span class="_ _11"> </span>The SIE transfers the data via the DMA to or from the buffer pointed to by the</div><div class="t m0 x117 hf y367b ff3 fs5 fc0 sc0 ls0 ws0">ADDR field of the BD.</div><div class="t m0 xf6 hf y367c ff3 fs5 fc0 sc0 ls0 ws0">3.<span class="_ _11"> </span>When the TOKEN is complete, the USB-FS updates the BDT and, if KEEP=0,</div><div class="t m0 x117 hf y367d ff3 fs5 fc0 sc0 ls0 ws0">changes the OWN bit to 0.</div><div class="t m0 xf6 hf y367e ff3 fs5 fc0 sc0 ls0 ws0">4.<span class="_ _11"> </span>The STAT register is updated and the TOK_DNE interrupt is set.</div><div class="t m0 xf6 hf y367f ff3 fs5 fc0 sc0 ls0 ws0">5.<span class="_ _11"> </span>When the processor processes the TOK_DNE interrupt, it reads from the status</div><div class="t m0 x117 hf y3680 ff3 fs5 fc0 sc0 ls0 ws0">register all the information needed to process the endpoint.</div><div class="t m0 xf6 hf y3681 ff3 fs5 fc0 sc0 ls0 ws0">6.<span class="_ _11"> </span>At this point, the processor allocates a new BD so that additional USB data can be</div><div class="t m0 x117 hf y3682 ff3 fs5 fc0 sc0 ls0 ws0">transmitted or received for that endpoint, and then processes the last BD.</div><div class="t m0 x9 hf y3683 ff3 fs5 fc0 sc0 ls0 ws0">The following figure shows a timeline of how a typical USB token is processed after the</div><div class="t m0 x9 hf y3684 ff3 fs5 fc0 sc0 ls0 ws0">BDT is read and OWN=1.</div><div class="t m0 xea h10 y141 ff1 fs4 fc0 sc0 ls0 ws0">Chapter 35 Universal Serial Bus OTG Controller (USBOTG)</div><div class="t m0 x8 h6 y9 ff1 fs3 fc0 sc0 ls0 ws0">KL25 Sub-Family Reference Manual, Rev. 3, September 2012</div><div class="t m0 x9 h7 ya ff2 fs4 fc0 sc0 ls0 ws0">Freescale Semiconductor, Inc.<span class="_ _113"> </span>619</div></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>
