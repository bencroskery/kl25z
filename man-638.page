<div id="pf27e" class="pf w0 h0" data-page-no="27e"><div class="pc pc27e w0 h0"><img class="bi x0 y8 w3 h5" alt="" src="bg27e.png"/><div class="t m0 x9e h9 yf57 ff1 fs2 fc0 sc0 ls0 ws20b">USB<span class="ff7">x</span><span class="ws0">_TOKEN field descriptions (continued)</span></div><div class="t m0 x12c h10 yf84 ff1 fs4 fc0 sc0 ls0 ws25f">Field Description</div><div class="t m0 x83 h7 yff6 ff2 fs4 fc0 sc0 ls0 ws0">0001<span class="_ _189"> </span>OUT Token. USB Module performs an OUT (TX) transaction.</div><div class="t m0 x83 h7 yff7 ff2 fs4 fc0 sc0 ls0 ws0">1001<span class="_ _189"> </span>IN Token. USB Module performs an In (RX) transaction.</div><div class="t m0 x83 h7 y1175 ff2 fs4 fc0 sc0 ls0 ws0">1101<span class="_ _189"> </span>SETUP Token. USB Module performs a SETUP (TX) transaction</div><div class="t m0 x1 h7 y11ce ff2 fs4 fc0 sc0 ls0">3–0</div><div class="t m0 x9a h7 y387d ff2 fs4 fc0 sc0 ls0">TOKENENDPT</div><div class="t m0 x83 h7 y11ce ff2 fs4 fc0 sc0 ls0 ws0">Holds the Endpoint address for the token command. The four bit value written must be a valid endpoint.</div><div class="t m0 x9 h1b y387e ff1 fsc fc0 sc0 ls0 ws0">35.4.20<span class="_ _b"> </span>SOF Threshold Register (USB<span class="ff7 ws24e">x</span>_SOFTHLD)</div><div class="t m0 x9 hf y387f ff3 fs5 fc0 sc0 ls0 ws0">The SOF Threshold Register is used only in Host mode (HOSTMODEEN=1). When in</div><div class="t m0 x9 hf y3880 ff3 fs5 fc0 sc0 ls0 ws0">Host mode, the 14-bit SOF counter counts the interval between SOF frames. The SOF</div><div class="t m0 x9 hf y3881 ff3 fs5 fc0 sc0 ls0 ws0">must be transmitted every 1ms so therefore the SOF counter is loaded with a value of</div><div class="t m0 x9 hf y3882 ff3 fs5 fc0 sc0 ls0 ws0">12000. When the SOF counter reaches zero, a Start Of Frame (SOF) token is transmitted.</div><div class="t m0 x9 hf y3883 ff3 fs5 fc0 sc0 ls0 ws0">The SOF threshold register is used to program the number of USB byte times before the</div><div class="t m0 x9 hf y3884 ff3 fs5 fc0 sc0 ls0 ws0">SOF to stop initiating token packet transactions. This register must be set to a value that</div><div class="t m0 x9 hf y3885 ff3 fs5 fc0 sc0 ls0 ws0">ensures that other packets are not actively being transmitted when the SOF time counts to</div><div class="t m0 x9 hf y3886 ff3 fs5 fc0 sc0 ls0 ws0">zero. When the SOF counter reaches the threshold value, no more tokens are transmitted</div><div class="t m0 x9 hf y3887 ff3 fs5 fc0 sc0 ls0 ws0">until after the SOF has been transmitted.</div><div class="t m0 x9 hf y3888 ff3 fs5 fc0 sc0 ls0 ws0">The value programmed into the threshold register must reserve enough time to ensure the</div><div class="t m0 x9 hf y3889 ff3 fs5 fc0 sc0 ls0 ws0">worst case transaction completes. In general the worst case transaction is an IN token</div><div class="t m0 x9 hf y388a ff3 fs5 fc0 sc0 ls0 ws0">followed by a data packet from the target followed by the response from the host. The</div><div class="t m0 x9 hf y388b ff3 fs5 fc0 sc0 ls0 ws0">actual time required is a function of the maximum packet size on the bus.</div><div class="t m0 x9 hf y388c ff3 fs5 fc0 sc0 ls0 ws0">Typical values for the SOF threshold are:</div><div class="t m0 x33 hf y388d ff3 fs5 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>64-byte packets=74;</div><div class="t m0 x33 hf y388e ff3 fs5 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>32-byte packets=42;</div><div class="t m0 x33 hf y388f ff3 fs5 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>16-byte packets=26;</div><div class="t m0 x33 hf y3890 ff3 fs5 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>8-byte packets=18.</div><div class="t m0 x9 h7 y3891 ff2 fs4 fc0 sc0 ls0 ws0">Address: 4007_2000h base + ACh offset = 4007_20ACh</div><div class="t m0 x81 h1d y3892 ff2 fsd fc0 sc0 ls0 ws284">Bit<span class="_ _165"> </span>7 6 5 4 3 2 1 0</div><div class="t m0 x1 h7 y3893 ff2 fs4 fc0 sc0 ls0 ws45f">Read <span class="ve">CNT</span></div><div class="t m0 x8b h7 y3894 ff2 fs4 fc0 sc0 ls0">Write</div><div class="t m0 x12c h7 y3895 ff2 fs4 fc0 sc0 ls0 ws2ab">Reset <span class="ls1c4 ws28a v1b">00000000<span class="_ _19a"></span></span></div><div class="t m0 x16 h9 y3896 ff1 fs2 fc0 sc0 ls0 ws20b">USB<span class="ff7">x</span><span class="ws0">_SOFTHLD field descriptions</span></div><div class="t m0 x12c h10 y3897 ff1 fs4 fc0 sc0 ls0 ws25f">Field Description</div><div class="t m0 x1 h7 y3898 ff2 fs4 fc0 sc0 ls0">7–0</div><div class="t m0 x12c h7 y3899 ff2 fs4 fc0 sc0 ls0">CNT</div><div class="t m0 x83 h7 y3898 ff2 fs4 fc0 sc0 ls0 ws0">Represents the SOF count threshold in byte times.</div><div class="t m0 x9 h10 ydd ff1 fs4 fc0 sc0 ls0 ws0">Memory map/Register definitions</div><div class="t m0 x8 h6 y9 ff1 fs3 fc0 sc0 ls0 ws0">KL25 Sub-Family Reference Manual, Rev. 3, September 2012</div><div class="t m0 x9 h7 ya ff2 fs4 fc0 sc0 ls0 ws0">638<span class="_ _113"> </span>Freescale Semiconductor, Inc.</div><a class="l" href="#pf27e" data-dest-detail='[638,"XYZ",null,114.317,null]'><div class="d m1" style="border-style:none;position:absolute;left:324.753000px;bottom:180.067000px;width:18.494000px;height:9.000000px;background-color:rgba(255,255,255,0.000001);"></div></a></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>
