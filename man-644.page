<div id="pf284" class="pf w0 h0" data-page-no="284"><div class="pc pc284 w0 h0"><img class="bi x0 y8 w2 h5" alt="" src="bg284.png"/><div class="t m0 x9 hd y150 ff1 fs7 fc0 sc0 ls0 ws0">35.5<span class="_ _b"> </span>OTG and Host mode operation</div><div class="t m0 x9 hf y151 ff3 fs5 fc0 sc0 ls0 ws0">The Host mode logic allows devices such as digital cameras and palmtop computers to</div><div class="t m0 x9 hf y152 ff3 fs5 fc0 sc0 ls0 ws0">function as a USB Host Controller. The OTG logic adds an interface to allow the OTG</div><div class="t m0 x9 hf y825 ff3 fs5 fc0 sc0 ls0 ws0">Host Negotiation and Session Request Protocols (HNP and SRP) to be implemented in</div><div class="t m0 x9 hf y94e ff3 fs5 fc0 sc0 ls0 ws0">software. Host Mode allows a peripheral such as a digital camera to be connected directly</div><div class="t m0 x9 hf y94f ff3 fs5 fc0 sc0 ls0 ws0">to a USB compliant printer. Digital photos can then be easily printed without having to</div><div class="t m0 x9 hf ybe3 ff3 fs5 fc0 sc0 ls0 ws0">upload them to a PC. In the palmtop computer application, a USB compliant keyboard/</div><div class="t m0 x9 hf yc84 ff3 fs5 fc0 sc0 ls0 ws0">mouse can be connected to the palmtop computer with the obvious advantages of easier</div><div class="t m0 x9 hf y38fa ff3 fs5 fc0 sc0 ls0">interaction.</div><div class="t m0 x9 hf ybe6 ff3 fs5 fc0 sc0 ls0 ws0">Host mode is intended for use in handheld-portable devices to allow easy connection to</div><div class="t m0 x9 hf ybe7 ff3 fs5 fc0 sc0 ls0 ws0">simple HID class devices such as printers and keyboards. It is not intended to perform the</div><div class="t m0 x9 hf yc85 ff3 fs5 fc0 sc0 ls0 ws0">functions of a full OHCI or UHCI compatible host controller found on PC motherboards.</div><div class="t m0 x9 hf yc86 ff3 fs5 fc0 sc0 ls0 ws0">The USB-FS is not supported by Windows 98 as a USB host controller. Host mode</div><div class="t m0 x9 hf yc87 ff3 fs5 fc0 sc0 ls0 ws0">allows bulk, isochronous, interrupt and control transfers. Bulk data transfers are</div><div class="t m0 x9 hf yc88 ff3 fs5 fc0 sc0 ls0 ws0">performed at nearly the full USB interface bandwidth. Support is provided for ISO</div><div class="t m0 x9 hf y38fb ff3 fs5 fc0 sc0 ls0 ws0">transfers, but the number of ISO streams that can be practically supported is affected by</div><div class="t m0 x9 hf y38fc ff3 fs5 fc0 sc0 ls0 ws0">the interrupt latency of the processor servicing the token during interrupts from the SIE.</div><div class="t m0 x9 hf y38fd ff3 fs5 fc0 sc0 ls0 ws0">Custom drivers must be written to support Host mode operation.</div><div class="t m0 x9 hf y38fe ff3 fs5 fc0 sc0 ls0 ws0">Setting the HOST_MODE_EN bit in the CTL register enables Host mode. The USB-FS</div><div class="t m0 x9 hf y38ff ff3 fs5 fc0 sc0 ls0 ws0">core can only operate as a peripheral device or in Host mode. It cannot operate in both</div><div class="t m0 x9 hf y3900 ff3 fs5 fc0 sc0 ls0 ws0">modes simultaneously. When HOST_MODE is enabled, only endpoint zero is used. All</div><div class="t m0 x9 hf y3901 ff3 fs5 fc0 sc0 ls0 ws0">other endpoints should be disabled by software.</div><div class="t m0 x9 hd y3902 ff1 fs7 fc0 sc0 ls0 ws0">35.6<span class="_ _b"> </span>Host Mode Operation Examples</div><div class="t m0 x9 hf yc91 ff3 fs5 fc0 sc0 ls0 ws0">The following sections illustrate the steps required to perform USB host functions using</div><div class="t m0 x9 hf yc92 ff3 fs5 fc0 sc0 ls0 ws0">the USB-FS core. While it is useful to understand the interaction of the hardware and the</div><div class="t m0 x9 hf ya2a ff3 fs5 fc0 sc0 ls0 ws0">software at a detailed level, an understanding of the interactions at this level is not</div><div class="t m0 x9 hf ya2b ff3 fs5 fc0 sc0 ls0 ws0">required to write host applications using the API software.</div><div class="t m0 x9 hf y3903 ff3 fs5 fc0 sc0 ls0 ws0">To enable host mode and discover a connected device:</div><div class="t m0 xf6 hf ya70 ff3 fs5 fc0 sc0 ls0 ws0">1.<span class="_ _11"> </span>Enable Host Mode (CTL[HOST_MODE_EN]=1). The pull-down resistors are</div><div class="t m0 x34 hf y3904 ff3 fs5 fc0 sc0 ls0 ws0">enabled, and pull-up disabled. Start of Frame (SOF) generation begins. SOF counter</div><div class="t m0 x34 hf y3905 ff3 fs5 fc0 sc0 ls0 ws0">loaded with 12,000. Disable SOF packet generation to eliminate noise on the USB by</div><div class="t m0 x34 hf y3906 ff3 fs5 fc0 sc0 ls0 ws0">writing the USB enable bit to 0 (CTL[USB_EN]=0).</div><div class="t m0 x9 h10 ydd ff1 fs4 fc0 sc0 ls0 ws0">OTG and Host mode operation</div><div class="t m0 x8 h6 y9 ff1 fs3 fc0 sc0 ls0 ws0">KL25 Sub-Family Reference Manual, Rev. 3, September 2012</div><div class="t m0 x9 h7 ya ff2 fs4 fc0 sc0 ls0 ws0">644<span class="_ _113"> </span>Freescale Semiconductor, Inc.</div></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>
