<div id="pf285" class="pf w0 h0" data-page-no="285"><div class="pc pc285 w0 h0"><img class="bi x0 y8 w2 h5" alt="" src="bg285.png"/><div class="t m0 xf6 hf yf6 ff3 fs5 fc0 sc0 ls0 ws0">2.<span class="_ _11"> </span>Enable the ATTACH interrupt (INT_ENB[ATTACH]=1).</div><div class="t m0 xf6 hf y503 ff3 fs5 fc0 sc0 ls0 ws0">3.<span class="_ _11"> </span>Wait for ATTACH interrupt (INT_STAT[ATTACH]). Signaled by USB Target pull-</div><div class="t m0 x117 hf y504 ff3 fs5 fc0 sc0 ls0 ws0">up resistor changing the state of DPLUS or DMINUS from 0 to 1 (SE0 to J or K</div><div class="t m0 x117 hf y505 ff3 fs5 fc0 sc0 ls0">state).</div><div class="t m0 xf6 hf y672 ff3 fs5 fc0 sc0 ls0 ws0">4.<span class="_ _11"> </span>Check the state of the JSTATE and SE0 bits in the control register. If the connecting</div><div class="t m0 x117 hf y673 ff3 fs5 fc0 sc0 ls0 ws0">device is low speed (JSTATE bit is 0), set the low-speed bit in the address registers</div><div class="t m0 x117 hf y674 ff3 fs5 fc0 sc0 ls0 ws0">(ADDR[LS_EN]=1) and the Host Without Hub bit in endpoint 0 register control</div><div class="t m0 x117 hf y675 ff3 fs5 fc0 sc0 ls0">(ENDPT0[HOSTWOHUB]=1).</div><div class="t m0 xf6 hf y1dd8 ff3 fs5 fc0 sc0 ls0 ws0">5.<span class="_ _11"> </span>Enable RESET (CTL[RESET]=1) for 10 ms.</div><div class="t m0 xf6 hf y1dd9 ff3 fs5 fc0 sc0 ls0 ws0">6.<span class="_ _11"> </span>Enable SOF packet to keep the connected device from going to suspend</div><div class="t m0 x117 hf y1dda ff3 fs5 fc0 sc0 ls0">(CTL[USB_EN=1]).</div><div class="t m0 xf6 hf y3907 ff3 fs5 fc0 sc0 ls0 ws0">7.<span class="_ _11"> </span>Start enumeration by sending a sequence of device framework commands, device</div><div class="t m0 x117 hf y3908 ff3 fs5 fc0 sc0 ls0 ws0">frame work packets to the default control pipe of the connected device. See the</div><div class="t m0 x117 hf y3909 ff4 fs5 fc0 sc0 ls0 ws0">Universal Serial Bus Revision 2.0 specification, <span class="ff3">&quot;Chapter 9 USB Device Framework&quot;</span></div><div class="t m0 x117 hf y390a ff3 fs5 fc0 sc0 ls0">(http://www.usb.org/developers/docs).</div><div class="t m0 x9 hf y390b ff3 fs5 fc0 sc0 ls0 ws0">To complete a control transaction to a connected device:</div><div class="t m0 xf6 hf y390c ff3 fs5 fc0 sc0 ls0 ws0">1.<span class="_ _11"> </span>Complete all the steps to discover a connected device</div><div class="t m0 xf6 hf yc99 ff3 fs5 fc0 sc0 ls0 ws0">2.<span class="_ _11"> </span>Set up the endpoint control register for bidirectional control transfers ENDPT0[4:0]</div><div class="t m0 x117 hf yc9a ff3 fs5 fc0 sc0 ls0 ws0">= 0x0d.</div><div class="t m0 xf6 hf y390d ff3 fs5 fc0 sc0 ls0 ws0">3.<span class="_ _11"> </span>Place a copy of the device framework setup command in a memory buffer. See the</div><div class="t m0 x117 hf y390e ff4 fs5 fc0 sc0 ls0 ws0">Universal Serial Bus Revision 2.0 specification, <span class="ff3">&quot;Chapter 9 USB Device Framework&quot;</span></div><div class="t m0 x117 hf y390f ff3 fs5 fc0 sc0 ls0">(http://www.usb.org/developers/docs).</div><div class="t m0 xf6 hf y3910 ff3 fs5 fc0 sc0 ls0 ws0">4.<span class="_ _11"> </span>Initialize current even or odd TX EP0 BDT to transfer the 8 bytes of command data</div><div class="t m0 x117 hf y3911 ff3 fs5 fc0 sc0 ls0 ws0">for a device framework command (for example, a GET DEVICE DESCRIPTOR).</div><div class="t m0 x2 hf y3912 ff3 fs5 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>Set the BDT command word to 0x00080080 –Byte count to 8, OWN bit to 1.</div><div class="t m0 x2 hf y3913 ff3 fs5 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>Set the BDT buffer address field to the start address of the 8 byte command</div><div class="t m0 x3d hf y3914 ff3 fs5 fc0 sc0 ls0">buffer.</div><div class="t m0 xf6 hf y3915 ff3 fs5 fc0 sc0 ls0 ws0">5.<span class="_ _11"> </span>Set the USB device address of the target device in the address register (ADDR[6:0]).</div><div class="t m0 x117 hf y3916 ff3 fs5 fc0 sc0 ls0 ws0">After the USB bus reset, the device USB address is zero. It is set to some other value</div><div class="t m0 x117 hf y3917 ff3 fs5 fc0 sc0 ls0 ws0">usually 1 by the Set Address device framework command.</div><div class="t m0 xf6 hf y3918 ff3 fs5 fc0 sc0 ls0 ws0">6.<span class="_ _11"> </span>Write the token register with a SETUP to Endpoint 0 the target device default control</div><div class="t m0 x117 hf y3919 ff3 fs5 fc0 sc0 ls0 ws0">pipe (TOKEN=0xD0). This initiates a setup token on the bus followed by a data</div><div class="t m0 x117 hf y391a ff3 fs5 fc0 sc0 ls0 ws0">packet. The device handshake is returned in the BDT PID field after the packets</div><div class="t m0 xea h10 y141 ff1 fs4 fc0 sc0 ls0 ws0">Chapter 35 Universal Serial Bus OTG Controller (USBOTG)</div><div class="t m0 x8 h6 y9 ff1 fs3 fc0 sc0 ls0 ws0">KL25 Sub-Family Reference Manual, Rev. 3, September 2012</div><div class="t m0 x9 h7 ya ff2 fs4 fc0 sc0 ls0 ws0">Freescale Semiconductor, Inc.<span class="_ _113"> </span>645</div></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>
