<div id="pf29d" class="pf w0 h0" data-page-no="29d"><div class="pc pc29d w0 h0"><img class="bi x0 y8 w2 h5" alt="" src="bg29d.png"/><div class="t m0 x9 hf yf6 ff3 fs5 fc0 sc0 ls0 ws0">The clock phase control bit (CPHA) and clock polarity control bit (CPOL) in the SPI</div><div class="t m0 x9 hf yf7 ff3 fs5 fc0 sc0 ls0 ws0">Control Register 1 (SPIx_C1) select one of four possible clock formats to be used by the</div><div class="t m0 x9 hf yf8 ff3 fs5 fc0 sc0 ls0 ws0">SPI system. The CPOL bit simply selects a non-inverted or inverted clock. The CPHA bit</div><div class="t m0 x9 hf yf9 ff3 fs5 fc0 sc0 ls0 ws0">is used to accommodate two fundamentally different protocols by sampling data on odd</div><div class="t m0 x9 hf yfa ff3 fs5 fc0 sc0 ls0 ws0">numbered SPSCK edges or on even numbered SPSCK edges.</div><div class="t m0 x9 hf y62a ff3 fs5 fc0 sc0 ls0 ws0">The SPI can be configured to operate as a master or as a slave. When the MSTR bit in</div><div class="t m0 x9 hf yabd ff3 fs5 fc0 sc0 ls0 ws0">SPI Control Register 1 is set, master mode is selected; when the MSTR bit is clear, slave</div><div class="t m0 x9 hf y644 ff3 fs5 fc0 sc0 ls0 ws0">mode is selected.</div><div class="t m0 x9 he y31c5 ff1 fs1 fc0 sc0 ls0 ws0">37.4.2<span class="_ _b"> </span>Master Mode</div><div class="t m0 x9 hf y279a ff3 fs5 fc0 sc0 ls0 ws0">The SPI operates in master mode when the MSTR bit is set. Only a master SPI module</div><div class="t m0 x9 hf y279b ff3 fs5 fc0 sc0 ls0 ws0">can initiate transmissions. A transmission begins by reading the SPIx_S register while</div><div class="t m0 x9 hf y952 ff3 fs5 fc0 sc0 ls0 ws0">SPTEF = 1 and writing to the master SPI data registers. If the shift register is empty, the</div><div class="t m0 x9 hf yabf ff3 fs5 fc0 sc0 ls0 ws0">byte immediately transfers to the shift register. The data begins shifting out on the MOSI</div><div class="t m0 x9 hf yac0 ff3 fs5 fc0 sc0 ls0 ws0">pin under the control of the serial clock.</div><div class="t m0 x33 hf yac1 ff3 fs5 fc0 sc0 ls0 ws199">• SPSCK</div><div class="t m0 x2 hf y3afc ff3 fs5 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>The SPR3, SPR2, SPR1, and SPR0 baud rate selection bits in conjunction with</div><div class="t m0 x3d hf y3afd ff3 fs5 fc0 sc0 ls0 ws0">the SPPR2, SPPR1, and SPPR0 baud rate preselection bits in the SPI Baud Rate</div><div class="t m0 x3d hf y2f50 ff3 fs5 fc0 sc0 ls0 ws0">register control the baud rate generator and determine the speed of the</div><div class="t m0 x3d hf y2f51 ff3 fs5 fc0 sc0 ls0 ws0">transmission. The SPSCK pin is the SPI clock output. Through the SPSCK pin,</div><div class="t m0 x3d hf y2f52 ff3 fs5 fc0 sc0 ls0 ws0">the baud rate generator of the master controls the shift register of the slave</div><div class="t m0 x3d hf yac7 ff3 fs5 fc0 sc0 ls0">peripheral.</div><div class="t m0 x33 hf y2f53 ff3 fs5 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>MOSI, MISO pin</div><div class="t m0 x2 hf y3afe ff3 fs5 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>In master mode, the function of the serial data output pin (MOSI) and the serial</div><div class="t m0 x3d hf y3aff ff3 fs5 fc0 sc0 ls0 ws0">data input pin (MISO) is determined by the SPC0 and BIDIROE control bits.</div><div class="t m0 x33 hf y3b00 ff3 fs5 fc0 sc0 ls283">•<span class="ls0 ws0 v0">SS pin</span></div><div class="t m0 x2 hf y3b01 ff3 fs5 fc0 sc0 ls0 ws0">•<span class="_ _11"> </span>If MODFEN and SSOE bit are set, the SS pin is configured as slave select</div><div class="t m0 x3d hf y3b02 ff3 fs5 fc0 sc0 ls0 ws0">output. The SS output becomes low during each transmission and is high when</div><div class="t m0 x3d hf y2b96 ff3 fs5 fc0 sc0 ls0 ws0">the SPI is in idle state. If MODFEN is set and SSOE is cleared, the SS pin is</div><div class="t m0 x3d hf y2b97 ff3 fs5 fc0 sc0 ls0 ws0">configured as input for detecting mode fault error. If the SS input becomes low</div><div class="t m0 x3d hf y2b98 ff3 fs5 fc0 sc0 ls0 ws0">this indicates a mode fault error where another master tries to drive the MOSI</div><div class="t m0 x3d hf y2b99 ff3 fs5 fc0 sc0 ls0 ws0">and SPSCK lines. In this case, the SPI immediately switches to slave mode by</div><div class="t m0 x3d hf y3b03 ff3 fs5 fc0 sc0 ls0 ws0">clearing the MSTR bit and also disables the slave output buffer MISO (or SISO</div><div class="t m0 x3d hf y3b04 ff3 fs5 fc0 sc0 ls0 ws0">in bidirectional mode). As a result, all outputs are disabled, and SPSCK, MOSI</div><div class="t m0 x3d hf y3b05 ff3 fs5 fc0 sc0 ls0 ws0">and MISO are inputs. If a transmission is in progress when the mode fault</div><div class="t m0 x3d hf y3b06 ff3 fs5 fc0 sc0 ls0 ws0">occurs, the transmission is aborted and the SPI is forced into idle state. This</div><div class="t m0 xec h10 y141 ff1 fs4 fc0 sc0 ls0 ws0">Chapter 37 Serial Peripheral Interface (SPI)</div><div class="t m0 x8 h6 y9 ff1 fs3 fc0 sc0 ls0 ws0">KL25 Sub-Family Reference Manual, Rev. 3, September 2012</div><div class="t m0 x9 h7 ya ff2 fs4 fc0 sc0 ls0 ws0">Freescale Semiconductor, Inc.<span class="_ _113"> </span>669</div></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>
