<div id="pf2ab" class="pf w0 h0" data-page-no="2ab"><div class="pc pc2ab w0 h0"><img class="bi x0 y8 w2 h5" alt="" src="bg2ab.png"/><div class="t m0 x9 h1b y502 ff1 fsc fc0 sc0 ls0 ws0">37.4.11.5<span class="_ _b"> </span>Asynchronous interrupt in low power modes</div><div class="t m0 x9 hf y2c42 ff3 fs5 fc0 sc0 ls0 ws0">When the CPU is in wait mode or stop mode and the SPI module receives a transmission,</div><div class="t m0 x9 hf y2c43 ff3 fs5 fc0 sc0 ls0 ws0">the SPI module can generate an asynchronous interrupt to wake the CPU from the low</div><div class="t m0 x9 hf y2c44 ff3 fs5 fc0 sc0 ls0 ws0">power mode. The module generates the asynchronous interrupt only when all of the</div><div class="t m0 x9 hf y2c45 ff3 fs5 fc0 sc0 ls0 ws0">following conditions apply:</div><div class="t m0 xf6 hf y2c46 ff3 fs5 fc0 sc0 ls0 ws0">1.<span class="_ _11"> </span>The C1[SPIE] bit is set to 1.</div><div class="t m0 xf6 hf y2c47 ff3 fs5 fc0 sc0 ls0 ws0">2.<span class="_ _11"> </span>The CPU is in wait mode—in which case the C2[SPISWAI] bit must be 1—or in</div><div class="t m0 x117 hf y2c48 ff3 fs5 fc0 sc0 ls0 ws0">stop mode where the peripheral bus clock is stopped but internal logic states are</div><div class="t m0 x117 hf y291 ff3 fs5 fc0 sc0 ls0">retained.</div><div class="t m0 xf6 hf y3c3c ff3 fs5 fc0 sc0 ls0 ws0">3.<span class="_ _11"> </span>The SPI module is in slave mode.</div><div class="t m0 xf6 hf y39b7 ff3 fs5 fc0 sc0 ls0 ws0">4.<span class="_ _11"> </span>The received transmission ends.</div><div class="t m0 x9 hf y2c4b ff3 fs5 fc0 sc0 ls0 ws0">After the interrupt wakes the CPU and the peripheral bus clock is active again, the SPI</div><div class="t m0 x9 hf y3c3d ff3 fs5 fc0 sc0 ls0 ws0">module copies the received data from the shifter into the Data register and generates flags</div><div class="t m0 x9 hf y3c3e ff3 fs5 fc0 sc0 ls0 ws0">or DMA request signals. During the wakeup phase, a continuous transmission from a</div><div class="t m0 x9 hf y3c3f ff3 fs5 fc0 sc0 ls0 ws0">master would destroy the first received data.</div><div class="t m0 x9 hd y3c40 ff1 fs7 fc0 sc0 ls0 ws0">37.5<span class="_ _b"> </span>Initialization/Application Information</div><div class="t m0 x9 hf yac3 ff3 fs5 fc0 sc0 ls0 ws0">This section discusses an example of how to initialize and use the SPI.</div><div class="t m0 x9 he y3c41 ff1 fs1 fc0 sc0 ls0 ws0">37.5.1<span class="_ _b"> </span>Initialization Sequence</div><div class="t m0 x9 hf y2f49 ff3 fs5 fc0 sc0 ls0 ws0">Before the SPI module can be used for communication, an initialization procedure must</div><div class="t m0 x9 hf y2f4a ff3 fs5 fc0 sc0 ls0 ws0">be carried out, as follows:</div><div class="t m0 xf6 hf y2f5f ff3 fs5 fc0 sc0 ls0 ws0">1.<span class="_ _11"> </span>Update control register 1 (SPIx_C1) to enable the SPI and to control interrupt</div><div class="t m0 x34 hf y2f60 ff3 fs5 fc0 sc0 ls0 ws0">enables. This register also sets the SPI as master or slave, determines clock phase and</div><div class="t m0 x34 hf y2f61 ff3 fs5 fc0 sc0 ls0 ws0">polarity, and configures the main SPI options.</div><div class="t m0 xf6 hf y3c42 ff3 fs5 fc0 sc0 ls0 ws0">2.<span class="_ _11"> </span>Update control register 2 (SPIx_C2) to enable additional SPI functions such as the</div><div class="t m0 x34 hf y2f62 ff3 fs5 fc0 sc0 ls0 ws0">SPI match interrupt feature, the master mode-fault function, and bidirectional mode</div><div class="t m0 x34 hf y2f63 ff3 fs5 fc0 sc0 ls0 ws0">output as well as to control and other optional features.</div><div class="t m0 xf6 hf y3c43 ff3 fs5 fc0 sc0 ls0 ws0">3.<span class="_ _11"> </span>Update the baud rate register (SPIx_BR) to set the prescaler and bit rate divisor for</div><div class="t m0 x34 hf y3c44 ff3 fs5 fc0 sc0 ls0 ws0">an SPI master.</div><div class="t m0 xf6 hf y3c45 ff3 fs5 fc0 sc0 ls0 ws0">4.<span class="_ _11"> </span>Update the hardware match register (SPIx_M) with the value to be compared to the</div><div class="t m0 x34 hf y3c46 ff3 fs5 fc0 sc0 ls0 ws0">receive data register for triggering an interrupt if hardware match interrupts are</div><div class="t m0 x34 hf y3c47 ff3 fs5 fc0 sc0 ls0">enabled.</div><div class="t m0 xec h10 y141 ff1 fs4 fc0 sc0 ls0 ws0">Chapter 37 Serial Peripheral Interface (SPI)</div><div class="t m0 x8 h6 y9 ff1 fs3 fc0 sc0 ls0 ws0">KL25 Sub-Family Reference Manual, Rev. 3, September 2012</div><div class="t m0 x9 h7 ya ff2 fs4 fc0 sc0 ls0 ws0">Freescale Semiconductor, Inc.<span class="_ _113"> </span>683</div></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>
